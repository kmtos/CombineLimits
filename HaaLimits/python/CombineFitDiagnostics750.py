import os
import sys
import logging
import itertools
import numpy as np
import argparse
import math
import errno

import ROOT
ROOT.PyConfig.IgnoreCommandLineOptions = True
ROOT.gROOT.SetBatch()

f1 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.12.root")
f2 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.123.root")
f3 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.1234.root")
f4 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.12345.root")
f5 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.123456.root")
f6 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.1234567.root")
f7 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.12345678.root")
f8 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.123456789.root")
f9 = ROOT.TFile("higgsCombineTest.FitDiagnostics.mH7.1234567890.root")
#f11 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.23.root")
#f12 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.234.root")
#f13 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.2345.root")
#f14 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.23456.root")
#f15 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.234567.root")
#f16 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.2345678.root")
#f17 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.23456789.root")
#f18 = ROOT.TFile("higgsCombineTest.GenerateOnly.mH7.234567890.root")

tree1 = f1.Get("limit")
tree2 = f2.Get("limit")
tree3 = f3.Get("limit")
tree4 = f4.Get("limit")
tree5 = f5.Get("limit")
tree6 = f6.Get("limit")
tree7 = f7.Get("limit")
tree8 = f8.Get("limit")
tree9 = f9.Get("limit")
#tree11 = f11.Get("limit")
#tree12 = f12.Get("limit")
#tree13 = f13.Get("limit")
#tree14 = f14.Get("limit")
#tree15 = f15.Get("limit")
#tree16 = f16.Get("limit")
#tree17 = f17.Get("limit")
#tree18 = f18.Get("limit")

tree1.Draw("((limit/10)-1)/limitErr>>h1(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree2.Draw("((limit/10)-1)/limitErr>>h2(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree3.Draw("((limit/10)-1)/limitErr>>h3(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree4.Draw("((limit/10)-1)/limitErr>>h4(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree5.Draw("((limit/10)-1)/limitErr>>h5(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree6.Draw("((limit/10)-1)/limitErr>>h6(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree7.Draw("((limit/10)-1)/limitErr>>h7(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree8.Draw("((limit/10)-1)/limitErr>>h8(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
tree9.Draw("((limit/10)-1)/limitErr>>h9(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree11.Draw("((limit/10)-1)/limitErr>>h11(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree12.Draw("((limit/10)-1)/limitErr>>h12(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree13.Draw("((limit/10)-1)/limitErr>>h13(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree14.Draw("((limit/10)-1)/limitErr>>h14(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree15.Draw("((limit/10)-1)/limitErr>>h15(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree16.Draw("((limit/10)-1)/limitErr>>h16(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree17.Draw("((limit/10)-1)/limitErr>>h17(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")
#tree18.Draw("((limit/10)-1)/limitErr>>h18(100,-2,2)", "limitErr>0.001 && limit>0.001 ")#&& limitErr<1.125")

h1 = ROOT.gDirectory.Get("h1")
h2 = ROOT.gDirectory.Get("h2")
h3 = ROOT.gDirectory.Get("h3")
h4 = ROOT.gDirectory.Get("h4")
h5 = ROOT.gDirectory.Get("h5")
h6 = ROOT.gDirectory.Get("h6")
h7 = ROOT.gDirectory.Get("h7")
h8 = ROOT.gDirectory.Get("h8")
h9 = ROOT.gDirectory.Get("h9")
#h11 = ROOT.gDirectory.Get("h11")
#h12 = ROOT.gDirectory.Get("h12")
#h13 = ROOT.gDirectory.Get("h13")
#h14 = ROOT.gDirectory.Get("h14")
#h15 = ROOT.gDirectory.Get("h15")
#h16 = ROOT.gDirectory.Get("h16")
#h17 = ROOT.gDirectory.Get("h17")
#h18 = ROOT.gDirectory.Get("h18")

h = h1.Clone()
h.Add(h2)
h.Add(h3)
h.Add(h4)
h.Add(h5)
h.Add(h6)
h.Add(h7)
h.Add(h8)
h.Add(h9)
#h.Add(h11)
#h.Add(h12)
#h.Add(h13)
#h.Add(h14)
#h.Add(h15)
#h.Add(h16)
#h.Add(h17)
#h.Add(h18)

fGaus = ROOT.TF1("fGaus", "gaus", -3, 3)

leg = ROOT.TLegend(.65,.6,.85,.9)
leg.SetBorderSize(0)
leg.SetFillColor(0)
leg.SetFillStyle(0)
leg.SetTextFont(42)
leg.SetTextSize(0.035)
leg.AddEntry(h,     "Bias Pull","L")
leg.AddEntry(fGaus, "Gaus Fit", "L")

outFile = ROOT.TFile("CombineFitDiagnostics750.root", 'recreate')
outFile.cd()
canvas = ROOT.TCanvas('c','c',800,800)
canvas.cd()
h.Draw()
h.Fit(fGaus)
h.Write()
leg.Draw()
canvas.Write()
canvas.Print("CombineFitDiagnostics750.png")


tree1.Draw("limit>>h_1p0(20,0,4)", "limitErr>0.001")# && limitErr<1.0")
tree1.Draw("limit>>h_0p75(30,0,4)",  "limitErr>0.001 && limitErr<0.75")
tree1.Draw("limit>>h_0p5(30,0,4)",  "limitErr>0.001 && limitErr<0.5")
h_1p0 = ROOT.gDirectory.Get("h_1p0")
h_0p75 = ROOT.gDirectory.Get("h_0p75")
h_0p5 = ROOT.gDirectory.Get("h_0p5")


outFile.Write()
outFile.Close()

